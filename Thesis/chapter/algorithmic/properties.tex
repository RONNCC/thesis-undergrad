
\section{Properties of Algorithmic Type-checking}

We now explore the properties of the bidirectional system analogous to the ones we proved for the multiset subtyping relation in \cref{refinements:subtyping-properties}.

\begin{lemma}[Weakening]
  If $\typeRecAJ P c \typeList$, then $\typeRecAJR {\ctx \concat \ctx'} P C {\typeList, \typeList'}$ for all $\typeList'$ and $\ctx'$ such that $\dom{\ctx'} \subseteq \dom\ctx$. Here, $\ctx \concat \ctx'$ is defined as follows:
  $$ \ctx \concat \ctx' = \setdef{c : \lookup \ctx c, \lookup {\ctx'} c}{c \in \dom\ctx \cap \dom{\ctx'}} \cup \parens{\ctx \setminus \dom{\ctx'}} \cup \parens{\ctx' \setminus \dom{\ctx}}.
  $$
\end{lemma}
\begin{proof}
  By a simple induction on the typing derivation since all rules are parametric in the unused types.
\end{proof}

% \begin{lemma}[Contraction]
%   The following are admissible:
%   \begin{itemize}
%     \item $\typeRecAJR \ctx P c {A, A, \typeList} \implies \typeRecAJR \ctx P c {A, \typeList}$.
%     \item $\typeRecAJR {\ctx, d : A, A, \typeList} P c \typeList \implies \typeRecAJR {\ctx, d : A, \typeList} P c \typeList$.
%   \end{itemize}
% \end{lemma}
% \begin{proof}
%   By induction on the typing derivation.
%   \todo{Do this proof.}
% \end{proof}

\begin{lemma}[Invertibility]
  \label{algorithmic:property-invertible}
  The following are admissible:
  \begin{description}
    % Intersection
    \item[$(\intersect\Right)$] $\typeRecAJ P c {A_1 \intersect A_2, \typeList} \iff \typeRecAJ P c {A_1, \typeList} \text{ and } \typeRecAJ P c {A_2, \typeList}$.
    \item[$(\intersect\Left)$] $\typeRecAJR {\ctx, d : \typeList, A_1 \intersect A_2} P c \typeListB \iff \typeRecAJR {\ctx, d : \typeList, A_1, A_2} P c \typeListB$.

    % Union
    \item[$(\union\Right)$] $\typeRecAJ P c {A_1 \union A_2, \typeList} \iff \typeRecAJ P c {A_1, A_2, \typeList}$.
    \item[$(\union\Left)$] $\typeRecAJR {\ctx, d : \typeList, A_1 \union A_2} P c \typeListB \iff
    \typeRecAJR {\ctx, d : \typeList, A_1} P c \typeListB
    \text{ and } \typeRecAJR {\ctx, d : \typeList, A_2} P c \typeListB$.

    % Recursive
    \item[$(\mu\Right)$] $\typeRecAJ P c {\recursive t A, \typeList} \iff \typeRecAJ P c {\subst {\recursive t A} t A, \typeList}$.
    \item[$(\mu\Left)$] $\typeRecAJR {\ctx, d : \typeList, \recursive t A} P c \typeListB \iff
    \typeRecAJR {\ctx, d : \typeList, \subst {\recursive t A} t A} P c \typeListB$.
  \end{description}
\end{lemma}
\begin{proof}
  Right to left is derivable by an application of $\intersect\Right$, $\intersect\Left$, $\union\Right, \union\Left, \mu\Right$, or $\mu\Left$ respectively. Forward direction is by induction on the typing derivation.
\end{proof}

